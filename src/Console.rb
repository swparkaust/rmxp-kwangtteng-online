#==============================================================================
# ■ Console
#------------------------------------------------------------------------------
# 　콘솔 표시용의 스프라이트입니다.
#------------------------------------------------------------------------------
# 　제작 : 광땡 (psw0107_2)
# 　버전 : 1.0
# 　날짜 : 2008/04/17 (yyyy/mm/dd)
#==============================================================================

class Console < Sprite
  #--------------------------------------------------------------------------
  # ● 오브젝트 초기화
  #     x           : 묘화처 X 좌표
  #     y            : 묘화처 Y 좌표
  #     width      : 묘화처의 폭
  #     height     : 묘화처의 높이
  #     max_line : 최대 줄 수
  #--------------------------------------------------------------------------
  def initialize(x, y, width, height, max_line = 8)
    @console_viewport = Viewport.new(0, 0, 640, 480)
    @console_viewport.z = 999
    super(@console_viewport)
    self.bitmap = Bitmap.new(width, height)
    self.x = x
    self.y = y
    self.z = 999
    @width = width
    @max_line = max_line
    @log = []
    hide
  end
  #--------------------------------------------------------------------------
  # ● 리프레쉬
  #--------------------------------------------------------------------------
  def refresh
    # 윈도우 내용을 클리어
    self.bitmap.clear
    @log.reverse!
    # 콘솔을 묘화
    self.bitmap.font.color.set(0, 0, 0, 255)
    for i in 0..@log.size - 1
      self.bitmap.draw_text(0, i * 16, @width, 32, @log[i])
    end
    @log.reverse!
  end
  #--------------------------------------------------------------------------
  # ● 텍스트 출력
  #     text  : 출력하는 문자열
  #--------------------------------------------------------------------------
  def writeline(text)
    @log.push text
    @log.delete_at(0) while @log.size > @max_line
    refresh
  end
  #--------------------------------------------------------------------------
  # ● 보인다
  #--------------------------------------------------------------------------
  def show
    self.opacity = 255
  end
  #--------------------------------------------------------------------------
  # ● 숨긴다
  #--------------------------------------------------------------------------
  def hide
    self.opacity = 0
  end
  #--------------------------------------------------------------------------
  # ● 클리어
  #--------------------------------------------------------------------------
  def clear
    # 윈도우 내용을 클리어
    self.bitmap.clear
    @log.clear
  end
  #--------------------------------------------------------------------------
  # ● 해방
  #--------------------------------------------------------------------------
  def dispose
    if self.bitmap != nil
      self.bitmap.dispose
    end
    super
  end
end
